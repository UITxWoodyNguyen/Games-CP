<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hanoi Tower - Trang chá»§</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <a href="spin.html" class="top-right-button">ğŸ¡ VÃ²ng quay may máº¯n </a>
    <div class="container">
        <h1 class="title">Hanoi Tower Game</h1>

        <div id="leaderboard" style="margin-bottom:2rem;text-align:center">
            <h2>ğŸ† Báº£ng xáº¿p háº¡ng</h2>
            <div id="leaderboard-table">Äang táº£i...</div>
        </div>

        <form class="player-form" action="game.html" method="GET">
            <div class="rules-section">
                <h2>ğŸ“œ Luáº­t chÆ¡i ThÃ¡p HÃ  Ná»™i</h2>
                <ul>
                    <li>ğŸª„ CÃ³ 3 cá»c vÃ  nhiá»u Ä‘Ä©a vá»›i kÃ­ch thÆ°á»›c khÃ¡c nhau.</li>
                    <li>ğŸ¯ Má»¥c tiÃªu: chuyá»ƒn toÃ n bá»™ Ä‘Ä©a sang cá»c khÃ¡c theo Ä‘Ãºng thá»© tá»± (lá»›n dÆ°á»›i, nhá» trÃªn).</li>
                    <li>ğŸš« Chá»‰ Ä‘Æ°á»£c di chuyá»ƒn <strong>1 Ä‘Ä©a má»—i láº§n</strong>.</li>
                    <li>â— KhÃ´ng Ä‘Æ°á»£c Ä‘áº·t <strong>Ä‘Ä©a lá»›n lÃªn trÃªn Ä‘Ä©a nhá»</strong>.</li>
                </ul>
            </div>

            <input type="text" name="player" placeholder="Báº¡n tÃªn gÃ¬?" required />

            <label for="discs">Chá»n sá»‘ Ä‘Ä©a:</label>
            <select name="discs" id="discs">
                <option value="3">3 Ä‘Ä©a</option>
                <option value="4">4 Ä‘Ä©a</option>
                <option value="5">5 Ä‘Ä©a</option>
                <option value="6">6 Ä‘Ä©a</option>
                <option value="7">7 Ä‘Ä©a</option>
                <option value="8">8 Ä‘Ä©a</option>
            </select>

            <button type="submit">Báº¯t Ä‘áº§u chÆ¡i</button>
        </form>
    </div>

    <script>
        // Kiá»ƒm tra náº¿u cÃ³ káº¿t quáº£ quay tá»« trang spin
        document.addEventListener('DOMContentLoaded', function () {
            const selectedDiscs = localStorage.getItem('selectedDiscs');
            const lockSelection = localStorage.getItem('lockSelection');
            const discsSelect = document.getElementById('discs');
            if (selectedDiscs) {
                discsSelect.value = selectedDiscs;
                localStorage.removeItem('selectedDiscs'); // XÃ³a Ä‘á»ƒ láº§n sau khÃ´ng tá»± Ä‘á»™ng chá»n láº¡i
                // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o
                alert(`Sá»‘ Ä‘Ä©a Ä‘Ã£ Ä‘Æ°á»£c chá»n: ${selectedDiscs} (tá»« vÃ²ng quay)`);
            }
            if (lockSelection) {
                discsSelect.disabled = true;
            }

            // Báº£ng xáº¿p háº¡ng
            const leaderboardTable = document.getElementById('leaderboard-table');
            fetch('https://opensheet.elk.sh/1c3Zy0gG_0Vg_7FofCh0zXMZgzPZI2SczvNBjlflVG7w/Form%20Responses%201')
                .then(res => res.json())
                .then(data => {
                    // Lá»c cÃ¡c báº£n ghi há»£p lá»‡
                    const valid = data.filter(row => row['TÃªn ngÆ°á»i chÆ¡i'] && row['Sá»‘ bÆ°á»›c'] && row['Káº¿t quáº£']==='Tháº¯ng');
                    // Sáº¯p xáº¿p theo sá»‘ bÆ°á»›c tÄƒng dáº§n, náº¿u báº±ng thÃ¬ thá»i gian tÄƒng dáº§n
                    valid.sort((a, b) => {
                        const movesA = parseInt(a['Sá»‘ bÆ°á»›c']);
                        const movesB = parseInt(b['Sá»‘ bÆ°á»›c']);
                        if (movesA !== movesB) return movesA - movesB;
                        // So sÃ¡nh thá»i gian (mm:ss)
                        const timeA = a['Thá»i gian'] ? a['Thá»i gian'].split(':').reduce((m,s,i)=>m*60+parseInt(s),0) : 9999;
                        const timeB = b['Thá»i gian'] ? b['Thá»i gian'].split(':').reduce((m,s,i)=>m*60+parseInt(s),0) : 9999;
                        return timeA - timeB;
                    });
                    // Láº¥y top 10
                    const top = valid.slice(0, 10);
                    if (top.length === 0) {
                        leaderboardTable.innerHTML = '<i>ChÆ°a cÃ³ dá»¯ liá»‡u</i>';
                        return;
                    }
                    let html = '<table style="width:100%;max-width:500px;margin:auto;border-collapse:collapse"><thead><tr><th>Háº¡ng</th><th>TÃªn</th><th>Sá»‘ Ä‘Ä©a</th><th>Sá»‘ bÆ°á»›c</th><th>Thá»i gian</th></tr></thead><tbody>';
                    top.forEach((row, i) => {
                        html += `<tr><td>${i+1}</td><td>${row['TÃªn ngÆ°á»i chÆ¡i']||''}</td><td>${row['Sá»‘ Ä‘Ä©a']||''}</td><td>${row['Sá»‘ bÆ°á»›c']||''}</td><td>${row['Thá»i gian']||''}</td></tr>`;
                    });
                    html += '</tbody></table>';
                    leaderboardTable.innerHTML = html;
                })
                .catch(() => {
                    leaderboardTable.innerHTML = '<i>Lá»—i táº£i dá»¯ liá»‡u báº£ng xáº¿p háº¡ng</i>';
                });
        });
    </script>
</body>


</html>
