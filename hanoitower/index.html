<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="https://imgs.search.brave.com/XIKBi3CY6n2covsRaYAz1SgwEnOlewUe2JS-dt703IU/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly90NC5m/dGNkbi5uZXQvanBn/LzAwLzAyLzE3LzYx/LzM2MF9GXzIxNzYx/MTlfV2o3ZElha3Vp/cjFCVW1Sa1BoTWZ4/Y21SazIzaXMyLmpw/Zw">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hanoi Tower - Trang chá»§</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
        <button class="mode-toggle-btn" id="mode-toggle-btn" title="Chuyá»ƒn Dark/White mode">ğŸŒ™ Dark Mode</button>
    <!-- XÃ³a nÃºt vÃ²ng quay trÃªn gÃ³c -->
    <div class="container">
        <h1 class="title">Hanoi Tower Game</h1>

        <div id="leaderboard" style="margin-bottom:2rem;text-align:center">
            <h2>ğŸ† Báº£ng xáº¿p háº¡ng</h2>
            <div style="margin-bottom: 1em;">
                <label for="filter-discs">Lá»c theo sá»‘ Ä‘Ä©a: </label>
                <select id="filter-discs">
                    <option value="all">Táº¥t cáº£</option>
                    <option value="3">3 Ä‘Ä©a</option>
                    <option value="4">4 Ä‘Ä©a</option>
                    <option value="5">5 Ä‘Ä©a</option>
                    <option value="6">6 Ä‘Ä©a</option>
                    <option value="7">7 Ä‘Ä©a</option>
                    <option value="8">8 Ä‘Ä©a</option>
                </select>
            </div>
            <div class="leaderboard-table-wrapper">
                <div id="leaderboard-table">Äang táº£i...</div>
            </div>
        </div>

        <form class="player-form" id="player-form" action="game.html" method="GET">
            <div class="rules-section">
                <h2>ğŸ“œ Luáº­t chÆ¡i ThÃ¡p HÃ  Ná»™i</h2>
                <ul>
                    <li>ğŸª„ CÃ³ 3 cá»c vÃ  nhiá»u Ä‘Ä©a vá»›i kÃ­ch thÆ°á»›c khÃ¡c nhau.</li>
                    <li>ğŸ¯ Má»¥c tiÃªu: chuyá»ƒn toÃ n bá»™ Ä‘Ä©a sang cá»c khÃ¡c theo Ä‘Ãºng thá»© tá»± (lá»›n dÆ°á»›i, nhá» trÃªn).</li>
                    <li>ğŸš« Chá»‰ Ä‘Æ°á»£c di chuyá»ƒn <strong>1 Ä‘Ä©a má»—i láº§n</strong>.</li>
                    <li>â— KhÃ´ng Ä‘Æ°á»£c Ä‘áº·t <strong>Ä‘Ä©a lá»›n lÃªn trÃªn Ä‘Ä©a nhá»</strong>.</li>
                </ul>
            </div>


            <input type="text" name="player" placeholder="Báº¡n tÃªn gÃ¬?" required id="player-name-input" />

            <div class="choose-mode-row">
                <label><input type="radio" name="choose_mode" value="manual" checked> Tá»± chá»n sá»‘ Ä‘Ä©a</label>
                <label><input type="radio" name="choose_mode" value="spin"> Quay vÃ²ng quay</label>
            </div>

            <div id="manual-select-block">
                <label for="discs">Chá»n sá»‘ Ä‘Ä©a:</label>
                <select name="discs" id="discs">
                    <option value="3">3 Ä‘Ä©a</option>
                    <option value="4">4 Ä‘Ä©a</option>
                    <option value="5">5 Ä‘Ä©a</option>
                    <option value="6">6 Ä‘Ä©a</option>
                    <option value="7">7 Ä‘Ä©a</option>
                    <option value="8">8 Ä‘Ä©a</option>
                </select>
            </div>
            <div id="spin-select-block" style="display:none;text-align:center;margin:1.2em 0">
                <a href="spin.html" class="spin-btn-in-form">ğŸ¡ Quay vÃ²ng quay chá»n sá»‘ Ä‘Ä©a</a>
            </div>

            <button type="submit" id="start-btn">Báº¯t Ä‘áº§u chÆ¡i</button>
        </form>
    </div>

    <script>
                // Dark/White mode toggle
                const modeBtn = document.getElementById('mode-toggle-btn');
                function setMode(mode) {
                    if (mode === 'dark') {
                        document.body.classList.add('dark-mode');
                        document.body.classList.remove('white-mode');
                        modeBtn.textContent = 'â˜€ï¸ White Mode';
                        localStorage.setItem('themeMode', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        document.body.classList.add('white-mode');
                        modeBtn.textContent = 'ğŸŒ™ Dark Mode';
                        localStorage.setItem('themeMode', 'white');
                    }
                }
                modeBtn.addEventListener('click', function() {
                    if (document.body.classList.contains('dark-mode')) {
                        setMode('white');
                    } else {
                        setMode('dark');
                    }
                });
                // Khá»Ÿi táº¡o theo localStorage
                const savedMode = localStorage.getItem('themeMode');
                setMode(savedMode === 'dark' ? 'dark' : 'white');
        document.addEventListener('DOMContentLoaded', function () {
                        // Khi submit form, náº¿u chá»n quay vÃ²ng quay thÃ¬ lÆ°u tÃªn vÃ o localStorage Ä‘á»ƒ spin.js láº¥y
                        const playerForm = document.getElementById('player-form');
                        playerForm.addEventListener('submit', function(e) {
                            const mode = document.querySelector('input[name="choose_mode"]:checked').value;
                            const playerName = playerForm.player.value;
                            localStorage.setItem('playerName', playerName);
                            if (mode === 'spin') {
                                // Chuyá»ƒn sang spin.html, khÃ´ng submit form
                                e.preventDefault();
                                window.location.href = 'spin.html';
                            }
                        });
            // Chuyá»ƒn Ä‘á»•i giá»¯a tá»± chá»n vÃ  quay vÃ²ng quay
            const radios = document.getElementsByName('choose_mode');
            const manualBlock = document.getElementById('manual-select-block');
            const spinBlock = document.getElementById('spin-select-block');
            const discsSelect = document.getElementById('discs');
            const startBtn = document.getElementById('start-btn');
            const playerNameInput = document.getElementById('player-name-input');
            radios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'manual') {
                        manualBlock.style.display = '';
                        spinBlock.style.display = 'none';
                        startBtn.style.display = '';
                        playerNameInput.style.display = '';
                        // Má»Ÿ khoÃ¡ select náº¿u bá»‹ disabled vÃ  xÃ³a lockSelection
                        if (discsSelect.disabled) discsSelect.disabled = false;
                        localStorage.removeItem('lockSelection');
                    } else {
                        manualBlock.style.display = 'none';
                        spinBlock.style.display = '';
                        startBtn.style.display = 'none';
                        playerNameInput.style.display = 'none';
                    }
                });
            });
            // Khá»Ÿi táº¡o tráº¡ng thÃ¡i nÃºt khi load láº¡i trang
            if (document.querySelector('input[name="choose_mode"]:checked').value === 'spin') {
                startBtn.style.display = 'none';
            }

            // Kiá»ƒm tra náº¿u cÃ³ káº¿t quáº£ quay tá»« trang spin
            const selectedDiscs = localStorage.getItem('selectedDiscs');
            const lockSelection = localStorage.getItem('lockSelection');
            if (selectedDiscs) {
                // Náº¿u quay vÃ²ng quay xong thÃ¬ tá»± chuyá»ƒn sang cháº¿ Ä‘á»™ tá»± chá»n vÃ  set value
                discsSelect.value = selectedDiscs;
                localStorage.removeItem('selectedDiscs');
                // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o
                alert(`Sá»‘ Ä‘Ä©a Ä‘Ã£ Ä‘Æ°á»£c chá»n: ${selectedDiscs} (tá»« vÃ²ng quay)`);
                // Chuyá»ƒn radio vá» manual
                document.querySelector('input[name="choose_mode"][value="manual"]').checked = true;
                manualBlock.style.display = '';
                spinBlock.style.display = 'none';
            }
            if (lockSelection) {
                discsSelect.disabled = true;
            }

            // HÃ m cáº­p nháº­t báº£ng xáº¿p háº¡ng
            function updateLeaderboard() {
                const leaderboardTable = document.getElementById('leaderboard-table');
                const filterDiscs = document.getElementById('filter-discs');
                const selectedDiscs = filterDiscs ? filterDiscs.value : 'all';
                fetch('https://opensheet.elk.sh/1c3Zy0gG_0Vg_7FofCh0zXMZgzPZI2SczvNBjlflVG7w/Form%20Responses%201')
                    .then(res => res.json())
                    .then(data => {
                        // Lá»c cÃ¡c báº£n ghi há»£p lá»‡
                        let valid = data.filter(row => row['TÃªn ngÆ°á»i chÆ¡i?'] && row['Sá»‘ bÆ°á»›c di chuyá»ƒn'] && row['Káº¿t quáº£?']==='Tháº¯ng');
                        // Lá»c theo sá»‘ Ä‘Ä©a náº¿u cÃ³ chá»n
                        if (selectedDiscs !== 'all') {
                            valid = valid.filter(row => {
                                // Há»— trá»£ cáº£ trÆ°á»ng 'Sá»‘ Ä‘Ä©a?' vÃ  'Sá»‘ Ä‘Ä©a'
                                return (row['Sá»‘ Ä‘Ä©a?'] || row['Sá»‘ Ä‘Ä©a']) == selectedDiscs;
                            });
                        }
                        // Sáº¯p xáº¿p theo sá»‘ bÆ°á»›c tÄƒng dáº§n, náº¿u báº±ng thÃ¬ thá»i gian tÄƒng dáº§n
                        valid.sort((a, b) => {
                            const movesA = parseInt(a['Sá»‘ bÆ°á»›c di chuyá»ƒn']);
                            const movesB = parseInt(b['Sá»‘ bÆ°á»›c di chuyá»ƒn']);
                            if (movesA !== movesB) return movesA - movesB;
                            // So sÃ¡nh thá»i gian (mm:ss)
                            const timeA = a['Thá»i gian chÆ¡i'] ? a['Thá»i gian chÆ¡i'].split(':').reduce((m,s,i)=>m*60+parseInt(s),0) : 9999;
                            const timeB = b['Thá»i gian chÆ¡i'] ? b['Thá»i gian chÆ¡i'].split(':').reduce((m,s,i)=>m*60+parseInt(s),0) : 9999;
                            return timeA - timeB;
                        });
                        // Láº¥y top 5
                        const top = valid.slice(0, 5);
                        if (top.length === 0) {
                            leaderboardTable.innerHTML = '<i>ChÆ°a cÃ³ dá»¯ liá»‡u</i>';
                            return;
                        }
                        let html = '<table class="leaderboard-table"><thead><tr><th>Háº¡ng</th><th>TÃªn</th><th>Sá»‘ Ä‘Ä©a</th><th>Sá»‘ bÆ°á»›c</th><th>Thá»i gian</th></tr></thead><tbody>';
                        top.forEach((row, i) => {
                            let rankClass = i < 3 ? `rank-${i+1}` : '';
                            html += `<tr><td class="${rankClass}">${i+1}</td><td>${row['TÃªn ngÆ°á»i chÆ¡i?']||''}</td><td>${row['Sá»‘ Ä‘Ä©a?']||row['Sá»‘ Ä‘Ä©a']||''}</td><td>${row['Sá»‘ bÆ°á»›c di chuyá»ƒn']||''}</td><td>${row['Thá»i gian chÆ¡i']||''}</td></tr>`;
                        });
                        html += '</tbody></table>';
                        leaderboardTable.innerHTML = html;
                    })
                    .catch(() => {
                        leaderboardTable.innerHTML = '<i>Lá»—i táº£i dá»¯ liá»‡u báº£ng xáº¿p háº¡ng</i>';
                    });
            }

            // Gáº¯n sá»± kiá»‡n filter
            const filterDiscs = document.getElementById('filter-discs');
            if (filterDiscs) {
                filterDiscs.addEventListener('change', updateLeaderboard);
            }

            updateLeaderboard();
            setInterval(updateLeaderboard, 5000); // Cáº­p nháº­t má»—i 5 giÃ¢y
        });
    </script>
</body>


</html>
